{
  "nodes": [
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "id": "73e2b689-25c7-46a6-bc8b-fa7b0c884927",
              "leftValue": "={{ (($json.skip ?? 0) + $json.limit) < $json.total }}",
              "rightValue": "true",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {
          "looseTypeValidation": false
        }
      },
      "id": "1cae11d5-f51c-4121-9bfd-f786ea25e76d",
      "name": "Has Next?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -192,
        496
      ]
    },
    {
      "parameters": {
        "url": "https://dummyjson.com/products",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "limit",
              "value": "30"
            },
            {
              "name": "skip",
              "value": "={{ $json.next_skip ?? 0 }}"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "id": "21a304f1-6ef8-42c4-b3d6-7d9d6ac6893e",
      "name": "HTTP Request",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [
        -560,
        496
      ],
      "retryOnFail": true,
      "waitBetweenTries": 5000,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -784,
        496
      ],
      "id": "7aea92eb-31bf-4649-b0ae-1881b41b0505",
      "name": "When clicking â€˜Execute workflowâ€™"
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1U3qzncTXCJRRB0eKFuJp41VcAUamtMTFpsoH4r_yjPU",
          "mode": "list",
          "cachedResultName": "n8n template - Shopify ã®ã‚³ãƒ”ãƒ¼",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1U3qzncTXCJRRB0eKFuJp41VcAUamtMTFpsoH4r_yjPU/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "shopify_orders",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1U3qzncTXCJRRB0eKFuJp41VcAUamtMTFpsoH4r_yjPU/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $json.id }}",
            "note": "={{ $json.title }}",
            "email": "={{ $json.stock }}",
            "processed_at": "={{ $json.category }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "processed_at",
              "displayName": "processed_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "note",
              "displayName": "note",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        352,
        608
      ],
      "id": "2b516b92-e700-4a26-9bd4-982f185be40e",
      "name": "Append or update row in sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "yHBJrEj3zL44ZWGQ",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -384,
        496
      ],
      "id": "405606ab-1899-472c-9a45-d5371e5024cc",
      "name": "Wait",
      "webhookId": "bdd07890-883d-467f-8346-5d68c7b33ca6"
    },
    {
      "parameters": {},
      "id": "0a620f65-a310-484d-b646-c5a8ef8f7f3c",
      "name": "ErrorTrigger:Global",
      "type": "n8n-nodes-base.errorTrigger",
      "typeVersion": 1,
      "position": [
        -688,
        -192
      ]
    },
    {
      "parameters": {
        "jsCode": "const config = $json.config || {};\nconst w = $json.workflow || {};\nconst e = $json.execution || {};\nconst err = e.error || {};\n\nconst message = String(err.message || '').toLowerCase();\nconst code = String(err.code || '').toLowerCase();\nconst httpStatus = String(err.httpStatus || e.httpStatus || '');\nconst retryCount = Number(e.retryCount ?? 0);\n\n// å®Ÿè¡Œå‰ï¼ˆãƒˆãƒªã‚¬ãƒ¼/èªè¨¼/Cronç­‰ï¼‰ã£ã½ã„å ´åˆã¯ lastNodeExecuted ãŒç©ºã«ãªã‚ŠãŒã¡\nconst phase = e.lastNodeExecuted ? 'execution' : 'trigger';\n\n// é‡è¦åº¦åˆ¤å®šãƒ«ãƒ¼ãƒ«ï¼ˆå¿…è¦ã«å¿œã˜ã¦å¢—ã‚„ã—ã¦ãã ã•ã„ï¼‰\nlet severity = 'info';\nlet severityReason = 'æƒ…å ±é€šçŸ¥';\n\nif (/(auth|token|permission)/.test(message) || /(auth|token|permission)/.test(code) || /^(401|403)$/.test(httpStatus) || retryCount >= 3) {\n  severity = 'critical';\n  severityReason = 'èªè¨¼/ã‚¢ã‚¯ã‚»ã‚¹æ¨© or ãƒªãƒˆãƒ©ã‚¤å¤šç™º';\n} else if (/(timeout|econnreset|econnrefused|dns)/.test(message) || /(timeout|econnreset|econnrefused|dns)/.test(code) || /^(429|5\\d{2})$/.test(httpStatus)) {\n  severity = 'warning';\n  severityReason = 'ä¸€æ™‚çš„ãªæ¥ç¶šä¸è‰¯/ãƒ¬ãƒ¼ãƒˆåˆ¶é™/å¤–éƒ¨éšœå®³';\n}\n\nconst channel =\n  severity === 'critical' ? config.slack?.channel?.critical :\n  severity === 'warning' ? config.slack?.channel?.warning :\n  config.slack?.channel?.info;\n\nconst workflowUrl = w.url || $json.workflow?.url || '';\nconst executionUrl = $json.execution?.url || '';\nconst nodeName = err.node || e.lastNodeExecuted || 'æœªç‰¹å®š';\n\nconst title =\n  severity === 'critical' ? 'ğŸ”¥ é‡å¤§ã‚¨ãƒ©ãƒ¼' :\n  severity === 'warning' ? 'âš ï¸ æ³¨æ„ã‚¨ãƒ©ãƒ¼' :\n  'â„¹ï¸ æƒ…å ±ã‚¨ãƒ©ãƒ¼';\n\nconst phaseLine = phase === 'execution'\n  ? 'ï¼ˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œä¸­ã®ã‚¨ãƒ©ãƒ¼ï¼‰'\n  : 'ï¼ˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œå‰ã®ã‚¨ãƒ©ãƒ¼ï¼šãƒˆãƒªã‚¬ãƒ¼è¨­å®šãƒ»èªè¨¼ãƒ»Cronç­‰ã‚’ç¢ºèªï¼‰';\n\nconst lines = [\n  `${title} ${phaseLine}`,\n  `*Workflow:* ${w.name || w.id || 'unknown'}`,\n  `*Node:* ${nodeName}`,\n  `*Error:* ${err.message || 'è©³ç´°ãªã—'}`,\n  `*SeverityReason:* ${severityReason}`,\n  workflowUrl ? `â€¢ <${workflowUrl}|Workflowã‚’é–‹ã>` : null,\n  executionUrl ? `â€¢ <${executionUrl}|Executionãƒ­ã‚°ã‚’è¦‹ã‚‹>` : null,\n].filter(Boolean);\n\nreturn [{\n  json: {\n    ...$json,\n    phase,\n    severity,\n    severityReason,\n    slack: {\n      channel,\n      text: lines.join('\\n')\n    }\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -160,
        -192
      ],
      "id": "4c03bb02-3ca7-4cac-88d8-deda8c153f6a",
      "name": "Classify Severity"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "b9f3f68a-6fd6-4f31-9c64-c45c3b7c0e9a",
              "leftValue": "={{ $json.severity }}",
              "rightValue": "critical",
              "operator": {
                "type": "string",
                "operation": "equal",
                "singleValue": true
              }
            },
            {
              "id": "3670cf43-ea0a-4ccd-9925-266d8aa64c37",
              "leftValue": "={{ $json.severity }}",
              "rightValue": "critical",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        16,
        -192
      ],
      "id": "4d667969-93c3-47d7-9e6c-0a0aeb1ca468",
      "name": "If:Critical"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "0f6c25e1-0c0b-4b7a-bf3e-4d8d4f922f52",
              "leftValue": "={{ $json.severity }}",
              "rightValue": "warning",
              "operator": {
                "type": "string",
                "operation": "equal",
                "singleValue": true
              }
            },
            {
              "id": "86132321-6882-4b2e-98e9-c9aa342b172d",
              "leftValue": "={{ $json.severity }}",
              "rightValue": "warning",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        192,
        -96
      ],
      "id": "e74bc996-6844-469b-b443-0fd3c950a648",
      "name": "If:Warning"
    },
    {
      "parameters": {
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "={{ $json.config.slack.channel.critical }}",
          "mode": "name"
        },
        "text": "={{ $json.slack.text }}",
        "otherOptions": {}
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.4,
      "position": [
        400,
        -352
      ],
      "id": "a82c1046-8c15-415a-98d9-808fdb262de4",
      "name": "Slack:Critical",
      "webhookId": "45e2d135-bdb6-4c1f-ac19-907dc29d67fe",
      "credentials": {
        "slackApi": {
          "id": "uv78jPZ831aDUtpk",
          "name": "Slack account"
        }
      }
    },
    {
      "parameters": {
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "={{ $json.config.slack.channel.warning }}",
          "mode": "name"
        },
        "text": "={{ $json.slack.text }}",
        "otherOptions": {}
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.4,
      "position": [
        400,
        -176
      ],
      "id": "80496e22-f037-428c-bb7f-1ecf6c664944",
      "name": "Slack:Warning",
      "webhookId": "faed6803-7120-4997-a8d0-540cf7b9afdd",
      "credentials": {
        "slackApi": {
          "id": "uv78jPZ831aDUtpk",
          "name": "Slack account"
        }
      }
    },
    {
      "parameters": {
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "={{ $json.config.slack.channel.info }}",
          "mode": "name"
        },
        "text": "={{ $json.slack.text }}",
        "otherOptions": {}
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.4,
      "position": [
        400,
        -16
      ],
      "id": "ac1f0eaa-f773-4902-ad3e-a143f7ec4110",
      "name": "Slack:Info",
      "webhookId": "aa4eaac3-d5e3-46f5-8034-b0f3fe29ef4f",
      "credentials": {
        "slackApi": {
          "id": "uv78jPZ831aDUtpk",
          "name": "Slack account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "5f2b7e62-9e9b-4b84-9c4a-8bded0d2f6c0",
              "name": "config.appUrl",
              "value": "http://localhost:5678",
              "type": "string"
            },
            {
              "id": "c5b4c95b-34b8-4c0c-8f4a-9d9d3d8a4d7e",
              "name": "config.slack.channel.critical",
              "value": "ã‚¨ãƒ©ãƒ¼é€šçŸ¥-critical",
              "type": "string"
            },
            {
              "id": "1e8d6b53-7d5a-4b6f-9d12-4bd1d5bb59b1",
              "name": "config.slack.channel.warning",
              "value": "ã‚¨ãƒ©ãƒ¼é€šçŸ¥-warning",
              "type": "string"
            },
            {
              "id": "1d9f7e1a-2c7d-4b8f-ae7f-3f5a0a3b9bdf",
              "name": "config.slack.channel.info",
              "value": "ã‚¨ãƒ©ãƒ¼é€šçŸ¥-Info",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {
          "dotNotation": true
        }
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -512,
        -192
      ],
      "id": "93dbe42f-df0f-4c4b-b4f5-edef7c8687d3",
      "name": "config1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "e8d4b56f-3381-4096-906c-0876c7a6d3d1",
              "name": "workflow.url",
              "value": "={{ $json.config.appUrl.replace(/\\/$/, '') + \"/workflow/\" + $json.workflow.id }}",
              "type": "string"
            },
            {
              "id": "b4fcd2d8-0c98-4b0c-b0bd-6f1cc8e7a1a7",
              "name": "execution.url",
              "value": "={{ $json.execution?.id ? ($json.config.appUrl.replace(/\\/$/, '') + \"/execution/\" + $json.execution.id) : \"\" }}",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {
          "dotNotation": true
        }
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -336,
        -192
      ],
      "id": "bf5e4b59-1346-4ec8-a8b8-c63b3b5c60bf",
      "name": "Constants1"
    },
    {
      "parameters": {
        "content": "Slacké€šçŸ¥ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–ï¼ˆé‡è¦åº¦åˆ†å²ï¼‰ã‚’è¿½åŠ ã€‚\n\nã‚¨ãƒ©ãƒ¼å†…å®¹ï¼ˆmessage/code/httpStatus/retryCountï¼‰ã‹ã‚‰ severity ã‚’ critical / warning / info ã«è‡ªå‹•åˆ¤å®š\ncritical ã¯ã‚ªãƒ³ã‚³ãƒ¼ãƒ«å‘ã‘ã€warning/info ã¯é€šå¸¸ç›£è¦–å‘ã‘ã«é€šçŸ¥ãƒãƒ£ãƒ³ãƒãƒ«ã‚’å‡ºã—åˆ†ã‘\né€šçŸ¥æ–‡é¢ã« Workflowåã€è©²å½“ãƒãƒ¼ãƒ‰ã€ã‚¨ãƒ©ãƒ¼å†…å®¹ã€åˆ¤å®šç†ç”±ã€Workflow/Executionãƒªãƒ³ã‚¯ã‚’ä»˜ä¸\nå®Ÿè¡Œå‰ã‚¨ãƒ©ãƒ¼ï¼ˆãƒˆãƒªã‚¬ãƒ¼/èªè¨¼/Cronç­‰ï¼‰ã¨å®Ÿè¡Œä¸­ã‚¨ãƒ©ãƒ¼ã‚‚åŒºåˆ¥ã—ã¦æ¡ˆå†…ã§ãã‚‹ã‚ˆã†ã«ã—ãŸ",
        "height": 608,
        "width": 1472
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -800,
        -448
      ],
      "typeVersion": 1,
      "id": "09549738-adc2-42a7-aeb9-2b413151597c",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "jsCode": "const currnetData = $input.item.json;\n\n//  æ¬¡ã®ãƒšãƒ¼ã‚¸ã®æº–å‚™\nreturn {\n  json: {\n    ...currnetData,\n    next_skip: currnetData.skip + currnetData.limit,\n  }\n} \n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        80,
        272
      ],
      "id": "c33b008c-e17f-4e75-b2e2-a049946f4b2b",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "#all-monitaring-web-site",
          "mode": "name"
        },
        "text": "={{ $json.text }}",
        "otherOptions": {}
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.4,
      "position": [
        704,
        608
      ],
      "id": "9064de05-def9-4df6-b2ba-f48ed9287a16",
      "name": "Send a message",
      "webhookId": "6db5565c-967f-49a5-9570-66cd01fa30cd",
      "credentials": {
        "slackApi": {
          "id": "uv78jPZ831aDUtpk",
          "name": "Slack account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "let results = [],\n  i = 0;\n\ndo {\n  try {\n    results = results.concat($(\"HTTP Request\").all(0, i));\n  }catch(error) {\n    return results;\n  }\n  i ++;\n} while (true);"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        0,
        608
      ],
      "id": "61339237-4557-47e4-ba83-c6a6c7572398",
      "name": "Merge Loop Items"
    },
    {
      "parameters": {
        "fieldToSplitOut": "products",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        176,
        608
      ],
      "id": "239da446-fb0c-461b-80ed-817d3fdc8913",
      "name": "Split Out2"
    },
    {
      "parameters": {
        "jsCode": "// Google sheetsNodeã®å®Ÿè¡Œçµæœã‚’å…¨éƒ¨æ•°ãˆã‚‹\nconst allItems = $('Append or update row in sheet').all();\n\nreturn { \n  json: {\n    text: `âœ… å‡¦ç†å®Œäº†ï¼\\nåˆè¨ˆ ${allItems.length} ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«è¿½åŠ ã—ã¾ã—ãŸã€‚`\n  }\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        528,
        608
      ],
      "id": "e956cb77-feb9-437f-b59d-56feb6074633",
      "name": "Code in JavaScript"
    }
  ],
  "connections": {
    "Has Next?": {
      "main": [
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Merge Loop Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When clicking â€˜Execute workflowâ€™": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append or update row in sheet": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Has Next?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ErrorTrigger:Global": {
      "main": [
        [
          {
            "node": "config1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Classify Severity": {
      "main": [
        [
          {
            "node": "If:Critical",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If:Critical": {
      "main": [
        [
          {
            "node": "Slack:Critical",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If:Warning",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If:Warning": {
      "main": [
        [
          {
            "node": "Slack:Warning",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Slack:Info",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "config1": {
      "main": [
        [
          {
            "node": "Constants1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Constants1": {
      "main": [
        [
          {
            "node": "Classify Severity",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a message": {
      "main": [
        []
      ]
    },
    "Merge Loop Items": {
      "main": [
        [
          {
            "node": "Split Out2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out2": {
      "main": [
        [
          {
            "node": "Append or update row in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Send a message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "08f731f92ccc8a5c5da3db6ecfae52595f2e0a818d4d668579fc375e3f9539a9"
  }
}
